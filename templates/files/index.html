{% extends "base.html" %}
{% block title %}File Manager{% endblock %}

{% block body %}
<div class="flex space-between" style="margin-bottom: 2rem;">
    <h2><i class="fas fa-folder-open"></i> File Manager</h2>
</div>

<div class="card">
    <div class="flex space-between">
        <div>
            <i class="fas fa-folder text-muted"></i>
            <strong>Current Path:</strong> 
            <span class="text-muted">/{{ rel if rel else 'root' }}</span>
        </div>
        {% if rel %}
        <a href="/files?p={{ up }}" class="btn btn-outline btn-sm">
            <i class="fas fa-arrow-left"></i> Back
        </a>
        {% endif %}
    </div>
</div>

<!-- Action Buttons -->
<div class="card-grid">
    <!-- Upload File -->
    <div class="card">
        <h3 style="margin-top: 0;"><i class="fas fa-cloud-upload-alt"></i> Upload File</h3>
        <form method="post" action="/files/upload" enctype="multipart/form-data">
            <input type="hidden" name="rel" value="{{ rel }}">
            <div class="form-group">
                <input type="file" name="file" required>
            </div>
            <button type="submit" class="btn-primary">
                <i class="fas fa-upload"></i> Upload
            </button>
        </form>
    </div>

    <!-- Create Folder -->
    <div class="card">
        <h3 style="margin-top: 0;"><i class="fas fa-folder-plus"></i> New Folder</h3>
        <form method="post" action="/files/mkdir">
            <input type="hidden" name="rel" value="{{ rel }}">
            <div class="form-group">
                <input type="text" name="name" placeholder="Folder name" required>
            </div>
            <button type="submit" class="btn-success">
                <i class="fas fa-plus"></i> Create
            </button>
        </form>
    </div>

    <!-- Rename -->
    <div class="card">
        <h3 style="margin-top: 0;"><i class="fas fa-edit"></i> Rename</h3>
        <form method="post" action="/files/rename">
            <input type="hidden" name="rel" value="{{ rel }}">
            <div class="form-group">
                <input type="text" name="old" placeholder="Current name" required style="margin-bottom: 0.5rem;">
                <input type="text" name="new" placeholder="New name" required>
            </div>
            <button type="submit" class="btn-secondary">
                <i class="fas fa-check"></i> Rename
            </button>
        </form>
    </div>

    <!-- Delete -->
    <div class="card">
        <h3 style="margin-top: 0;"><i class="fas fa-trash"></i> Delete</h3>
        <form method="post" action="/files/delete" onsubmit="return confirm('Are you sure you want to delete this item?');">
            <input type="hidden" name="rel" value="{{ rel }}">
            <div class="form-group">
                <input type="text" name="target" placeholder="File or folder name" required>
            </div>
            <button type="submit" class="btn-danger">
                <i class="fas fa-trash-alt"></i> Delete
            </button>
        </form>
    </div>
</div>

<!-- Files and Folders List -->
<h3><i class="fas fa-list"></i> Contents</h3>
<div style="overflow-x: auto;">
    <table>
        <thead>
            <tr>
                <th><i class="fas fa-file"></i> Name</th>
                <th><i class="fas fa-user"></i> Owner</th>
                <th><i class="fas fa-cog"></i> Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if not items %}
            <tr>
                <td colspan="3" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                    <i class="fas fa-inbox" style="font-size: 3rem; display: block; margin-bottom: 1rem; opacity: 0.3;"></i>
                    This folder is empty
                </td>
            </tr>
            {% endif %}
            
            {% for item in items %}
            <tr>
                <td>
                    {% if item.is_dir %}
                        <i class="fas fa-folder" style="color: #f59e0b;"></i>
                        <a href="/files?p={{ item.rel }}" style="color: var(--primary); text-decoration: none; font-weight: 600;">
                            {{ item.name }}
                        </a>
                    {% else %}
                        <i class="fas fa-file" style="color: #64748b;"></i>
                        <strong>{{ item.name }}</strong>
                    {% endif %}
                </td>
                <td>
                    {% if item.owner %}
                        <span class="badge badge-primary">
                            <i class="fas fa-user"></i> {{ item.owner }}
                        </span>
                    {% else %}
                        <span class="text-muted">â€”</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        {% if not item.is_dir %}
                            <a href="/files/download?rel={{ item.rel }}" class="btn btn-sm" style="background: var(--info); color: white;">
                                <i class="fas fa-download"></i> Download
                            </a>
                            
                            {% if item.can_write or is_admin %}
                            <a href="/files/share/{{ item.file_id }}" class="btn btn-sm" style="background: var(--secondary); color: white;">
                                <i class="fas fa-share-alt"></i> Share
                            </a>
                            {% endif %}
                            
                            {% if item.can_delete or is_admin %}
                            <form method="post" action="/files/delete" style="display: inline;" onsubmit="return confirm('Delete {{ item.name }}?');">
                                <input type="hidden" name="rel" value="{{ rel }}">
                                <input type="hidden" name="target" value="{{ item.name }}">
                                <button type="submit" class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                            {% endif %}
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }
    
    .card h3 {
        font-size: 1.125rem;
        margin-top: 0;
        margin-bottom: 1rem;
        color: var(--primary-dark);
    }
</style>
{% endblock %}
