{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block body %}
<h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>

<!-- Quick Stats -->
<div class="card-grid">
    <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="color: white; margin: 0; font-size: 2.5rem;">
                    {% if current_user.is_authenticated %}
                    <i class="fas fa-check-circle"></i>
                    {% else %}
                    <i class="fas fa-times-circle"></i>
                    {% endif %}
                </h3>
                <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Authentication</p>
            </div>
            <i class="fas fa-user-shield" style="font-size: 3rem; opacity: 0.3;"></i>
        </div>
    </div>

    <div class="card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; border: none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="color: white; margin: 0; font-size: 2.5rem;">
                    {{ info.tables|length if info.tables else 0 }}
                </h3>
                <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Database Tables</p>
            </div>
            <i class="fas fa-database" style="font-size: 3rem; opacity: 0.3;"></i>
        </div>
    </div>

    <div class="card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; border: none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="color: white; margin: 0; font-size: 2.5rem;">
                    {% if info.connected %}
                    <i class="fas fa-link"></i>
                    {% else %}
                    <i class="fas fa-unlink"></i>
                    {% endif %}
                </h3>
                <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">MySQL Connection</p>
            </div>
            <i class="fas fa-server" style="font-size: 3rem; opacity: 0.3;"></i>
        </div>
    </div>

    <div class="card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; border: none;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h3 style="color: white; margin: 0; font-size: 1.5rem;">
                    {% if current_user.is_authenticated %}
                    {{ current_user.role|upper }}
                    {% else %}
                    GUEST
                    {% endif %}
                </h3>
                <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">User Role</p>
            </div>
            <i class="fas fa-id-badge" style="font-size: 3rem; opacity: 0.3;"></i>
        </div>
    </div>
</div>

<!-- System Status -->
<div class="card">
    <h3><i class="fas fa-info-circle"></i> System Status</h3>
    {% if info.connected %}
        <div style="padding: 1rem; background: #d1fae5; border-radius: 0.5rem; border-left: 4px solid var(--success);">
            <p style="margin: 0; color: #065f46; font-weight: 600;">
                <i class="fas fa-check-circle"></i> Successfully connected to MySQL database
            </p>
            <p style="margin: 0.5rem 0 0 0; color: #047857;">
                <strong>Available Tables:</strong> {{ info.tables | join(', ') }}
            </p>
        </div>
    {% else %}
        <div style="padding: 1rem; background: #fee2e2; border-radius: 0.5rem; border-left: 4px solid var(--danger);">
            <p style="margin: 0; color: #991b1b; font-weight: 600;">
                <i class="fas fa-exclamation-triangle"></i> MySQL Connection Failed
            </p>
            {% if info.error %}
            <p style="margin: 0.5rem 0 0 0; color: #dc2626;">
                <strong>Error:</strong> {{ info.error }}
            </p>
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Quick Actions -->
<h3><i class="fas fa-bolt"></i> Quick Actions</h3>
<div class="card-grid">
    <div class="card">
        <i class="fas fa-folder-open" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
        <h3 style="margin-top: 0;">File Manager</h3>
        <p class="text-muted">Upload, download, and manage your files</p>
        <a href="/files" class="btn btn-primary" style="margin-top: 1rem;">
            <i class="fas fa-arrow-right"></i> Open Files
        </a>
    </div>

    <div class="card">
        <i class="fas fa-chart-line" style="font-size: 2.5rem; color: var(--info); margin-bottom: 1rem;"></i>
        <h3 style="margin-top: 0;">System Monitor</h3>
        <p class="text-muted">View CPU, memory, and disk usage</p>
        <a href="/monitor" class="btn" style="background: var(--info); color: white; margin-top: 1rem;">
            <i class="fas fa-arrow-right"></i> View Stats
        </a>
    </div>

    <div class="card">
        <i class="fas fa-archive" style="font-size: 2.5rem; color: var(--warning); margin-bottom: 1rem;"></i>
        <h3 style="margin-top: 0;">Backup & Restore</h3>
        <p class="text-muted">Create and manage system backups</p>
        <a href="/backup" class="btn" style="background: var(--warning); color: white; margin-top: 1rem;">
            <i class="fas fa-arrow-right"></i> Manage Backups
        </a>
    </div>

    {% if current_user.is_authenticated and current_user.role == 'admin' %}
    <div class="card">
        <i class="fas fa-users-cog" style="font-size: 2.5rem; color: var(--secondary); margin-bottom: 1rem;"></i>
        <h3 style="margin-top: 0;">User Management</h3>
        <p class="text-muted">Manage users and permissions</p>
        <a href="/auth/users" class="btn" style="background: var(--secondary); color: white; margin-top: 1rem;">
            <i class="fas fa-arrow-right"></i> Manage Users
        </a>
    </div>
    {% endif %}
</div>

<!-- Setup Instructions -->
{% if not current_user.is_authenticated or (current_user.is_authenticated and current_user.username == 'admin') %}
<div class="card" style="background: #fef3c7; border-left: 4px solid var(--warning);">
    <h3><i class="fas fa-exclamation-circle"></i> Setup Required</h3>
    <p>For first-time setup, please create the admin user or log in:</p>
    <div style="display: flex; gap: 1rem; margin-top: 1rem;">
        {% if not current_user.is_authenticated %}
        <form method="post" action="/init_admin" style="display: inline;">
            <button type="submit" class="btn-warning" style="background: var(--warning); color: white;">
                <i class="fas fa-user-plus"></i> Create Admin User
            </button>
        </form>
        <a href="/auth/login" class="btn btn-primary">
            <i class="fas fa-sign-in-alt"></i> Login
        </a>
        {% else %}
        <p style="color: #92400e;">
            <strong>⚠️ Security Warning:</strong> You're logged in as the default admin. 
            Please change your password immediately in the User Management section.
        </p>
        {% endif %}
    </div>
</div>
{% endif %}

<style>
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin: 1.5rem 0;
    }
</style>
{% endblock %}
